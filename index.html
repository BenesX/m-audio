<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>m-audio</title>
    <link rel="stylesheet" href="./src/style.css">
    <link rel="stylesheet" href="./src/m-audio.css?v=3400">
</head>
<body>
    <audio src="http://118.24.53.102:8080/static/1.mp3" class="auo__audio-ele"></audio>
    <div class="auo">
        <div class="auo__box">
            <button class="auo__button auo__play-button icon-play3"></button> 
            <div class="auo__time-display">
                <div class="auo__time-current">00:00</div>/
                <div class="auo__time-total">00:00</div>
            </div> 
            <div class="auo__progress">
                <div class="auo__progress-mask"></div>
                <div class="auo__progress-bar"></div>
                <!-- <div class="auo__progress-point"></div> -->
            </div>
            <button class="auo__button auo__mute-button icon-volume-high">
                <!-- <div class="auo__volume-container">
                    <div class="auo__volume-number">100</div>
                    <div class="auo__volume">
                        <div class="auo__volume-mask"></div>
                        <div class="auo__volume-bar"></div>
                    </div>
                </div> -->
            </button>
            <!-- <button class="auo__button auo__more-button icon-volume-more"></button> -->
        </div>
    </div>
</body>
<script>
const $ = (flag) => {
    return document.querySelector(flag);
}
let audio = $('.auo__audio-ele');
let el_totalTime = $('.auo__time-total');
let el_currentTime = $('.auo__time-current');
let player = $('.auo');
let el_playBtn = $('.auo__play-button');
let el_progressBar = $('.auo__progress-bar');
let el_progressMask = $('.auo__progress-mask');
let el_muteBtn = $('.auo__mute-button');
let IS_TAPPED = false;
const maskWidth = parseInt(getComputedStyle(el_progressMask).width);
const maskLeft = el_progressMask.getClientRects()[0].left;

function transSecToMin (sec) {
    let h;
    h = Math.floor(sec / 60);
    sec = sec % 60;
    sec = sec.toFixed(0);
    h += '';
    sec += '';
    h = (h.length == 1) ? '0' + h : h;
    sec = (sec.length == 1) ? '0' + sec : sec;
    return h + ':' + sec;
}

const toggleAudioPlay = (isEnd) => {
    if (audio.paused && !isEnd) {
        audio.play();
        el_playBtn.classList.add('icon-pause2');
        el_playBtn.classList.remove('icon-play3');
    } else {
        audio.pause();
        el_playBtn.classList.remove('icon-pause2');
        el_playBtn.classList.add('icon-play3');
    }
}

const updateProgressbar = (percent) => {
    el_progressBar.style.width = `${percent}%`;
}

player.addEventListener('click', function (e) {
    if (e.target === el_playBtn) {
        toggleAudioPlay();
    } else if (e.target === el_progressMask) {
        const { offsetX } = e;
        const percent = offsetX / maskWidth;
        audio.currentTime = percent * audio.duration;
        updateProgressbar(percent * 100);
    } else if (e.target === el_muteBtn) {
        toggleAudioSound();
    }
}, false)

el_progressMask.addEventListener('touchstart', () => {
    IS_TAPPED = true;
})

el_progressMask.addEventListener('touchmove', (e) => {
    const pageX = e.touches[0].pageX;
    const offsetX = pageX - maskLeft;
    const percent = offsetX / maskWidth;
    updateProgressbar(percent * 100);
})

el_progressMask.addEventListener('touchend', (e) => {
    IS_TAPPED = false;
    const pageX = e.changedTouches[0].pageX;
    const offsetX = pageX - maskLeft;
    const percent = offsetX / maskWidth;
    audio.currentTime = percent * audio.duration;
})


audio.addEventListener('loadeddata', () => {
    el_totalTime.textContent = transSecToMin(audio.duration);
}, false);


audio.addEventListener('timeupdate', () => {
    const { currentTime, duration } = audio;
    !IS_TAPPED && updateProgressbar(currentTime / duration * 100);
    el_currentTime.textContent = transSecToMin(currentTime);
});

audio.addEventListener("ended", function () {
    const IS_END = true;
    toggleAudioPlay(IS_END);
}, false);




</script>
</html>